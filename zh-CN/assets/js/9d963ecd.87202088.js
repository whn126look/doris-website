"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["667212"],{928363:function(e,n,r){r.r(n),r.d(n,{metadata:()=>s,contentTitle:()=>i,default:()=>t,assets:()=>c,toc:()=>d,frontMatter:()=>a});var s=JSON.parse('{"id":"admin-manual/workload-management/best-practice/workload-group-best-practice","title":"Workload Group \u6700\u4F73\u5B9E\u8DF5","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.1/admin-manual/workload-management/best-practice/workload-group-best-practice.md","sourceDirName":"admin-manual/workload-management/best-practice","slug":"/admin-manual/workload-management/best-practice/workload-group-best-practice","permalink":"/zh-CN/docs/admin-manual/workload-management/best-practice/workload-group-best-practice","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"Workload Group \u6700\u4F73\u5B9E\u8DF5","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Workload Group \u5206\u7EC4\u529F\u80FD","permalink":"/zh-CN/docs/admin-manual/workload-management/best-practice/group-workload-groups"},"next":{"title":"SQL \u62E6\u622A","permalink":"/zh-CN/docs/admin-manual/query-admin/sql-interception"}}'),o=r("785893"),l=r("250065");let a={title:"Workload Group \u6700\u4F73\u5B9E\u8DF5",language:"zh-CN"},i=void 0,c={},d=[{value:"\u6D4B\u8BD5\u5185\u5B58\u786C\u9650",id:"\u6D4B\u8BD5\u5185\u5B58\u786C\u9650",level:2},{value:"\u6D4B\u8BD5\u73AF\u5883",id:"\u6D4B\u8BD5\u73AF\u5883",level:3},{value:"\u6D4B\u8BD5\u4E0D\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650",id:"\u6D4B\u8BD5\u4E0D\u5F00\u542F-workload-group-\u7684\u5185\u5B58\u786C\u9650",level:3},{value:"\u6D4B\u8BD5\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650",id:"\u6D4B\u8BD5\u5F00\u542F-workload-group-\u7684\u5185\u5B58\u786C\u9650",level:3},{value:"\u4F7F\u7528\u5EFA\u8BAE",id:"\u4F7F\u7528\u5EFA\u8BAE",level:3},{value:"CPU \u786C\u9650\u6D4B\u8BD5",id:"cpu-\u786C\u9650\u6D4B\u8BD5",level:2},{value:"\u6D4B\u8BD5\u73AF\u5883",id:"\u6D4B\u8BD5\u73AF\u5883-1",level:3},{value:"\u6D4B\u8BD5",id:"\u6D4B\u8BD5",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:3},{value:"\u6D4B\u8BD5\u672C\u5730 IO \u786C\u9650",id:"\u6D4B\u8BD5\u672C\u5730-io-\u786C\u9650",level:2},{value:"\u6D4B\u8BD5\u73AF\u5883",id:"\u6D4B\u8BD5\u73AF\u5883-2",level:3},{value:"\u4E0D\u5F00\u542F IO \u786C\u9650\u6D4B\u8BD5",id:"\u4E0D\u5F00\u542F-io-\u786C\u9650\u6D4B\u8BD5",level:3},{value:"\u5F00\u542F IO \u786C\u9650\u540E\u6D4B\u8BD5",id:"\u5F00\u542F-io-\u786C\u9650\u540E\u6D4B\u8BD5",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879-1",level:3},{value:"\u6D4B\u8BD5\u8FDC\u7A0B IO \u9650\u5236",id:"\u6D4B\u8BD5\u8FDC\u7A0B-io-\u9650\u5236",level:2},{value:"\u6D4B\u8BD5\u73AF\u5883",id:"\u6D4B\u8BD5\u73AF\u5883-3",level:3},{value:"\u6D4B\u8BD5\u4E0D\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO",id:"\u6D4B\u8BD5\u4E0D\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684-io",level:3},{value:"\u6D4B\u8BD5\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO",id:"\u6D4B\u8BD5\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684-io",level:3}];function _(e){let n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"\u6D4B\u8BD5\u5185\u5B58\u786C\u9650",children:"\u6D4B\u8BD5\u5185\u5B58\u786C\u9650"}),"\n",(0,o.jsx)(n.p,{children:"Adhoc \u7C7B\u67E5\u8BE2\u901A\u5E38\u8F93\u5165\u7684 SQL \u4E0D\u786E\u5B9A\uFF0C\u4F7F\u7528\u7684\u5185\u5B58\u8D44\u6E90\u4E5F\u4E0D\u786E\u5B9A\uFF0C\u56E0\u6B64\u5B58\u5728\u5C11\u6570\u67E5\u8BE2\u5360\u7528\u5F88\u5927\u5185\u5B58\u7684\u98CE\u9669\u3002\n\u53EF\u4EE5\u5BF9\u8FD9\u7C7B\u8D1F\u8F7D\u53EF\u4EE5\u5212\u5206\u5230\u72EC\u7ACB\u7684\u5206\u7EC4\uFF0C\u901A\u8FC7 Workload Group \u5BF9\u5185\u5B58\u7684\u786C\u9650\u7684\u529F\u80FD\uFF0C\u907F\u514D\u7A81\u53D1\u6027\u7684\u5927\u67E5\u8BE2\u5360\u6EE1\u6240\u6709\u5185\u5B58\uFF0C\u5BFC\u81F4\u5176\u4ED6\u67E5\u8BE2\u6CA1\u6709\u53EF\u7528\u5185\u5B58\u6216\u8005 OOM\u3002\n\u5F53\u8FD9\u4E2A Workload Group \u7684\u5185\u5B58\u4F7F\u7528\u8D85\u8FC7\u914D\u7F6E\u7684\u786C\u9650\u503C\u65F6\uFF0C\u4F1A\u901A\u8FC7\u6740\u6B7B\u67E5\u8BE2\u7684\u65B9\u5F0F\u91CA\u653E\u5185\u5B58\uFF0C\u907F\u514D\u8FDB\u7A0B\u5185\u5B58\u88AB\u6253\u6EE1\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u73AF\u5883",children:"\u6D4B\u8BD5\u73AF\u5883"}),"\n",(0,o.jsx)(n.p,{children:"1FE\uFF0C1BE\uFF0CBE \u914D\u7F6E\u4E3A 96 \u6838\uFF0C\u5185\u5B58\u5927\u5C0F\u4E3A 375G\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u6D4B\u8BD5\u6570\u636E\u96C6\u4E3A clickbench\uFF0C\u6D4B\u8BD5\u65B9\u6CD5\u4E3A\u4F7F\u7528 jmeter \u8D77\u4E09\u5E76\u53D1\u6267\u884C q29\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u4E0D\u5F00\u542F-workload-group-\u7684\u5185\u5B58\u786C\u9650",children:"\u6D4B\u8BD5\u4E0D\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u67E5\u770B\u8FDB\u7A0B\u4F7F\u7528\u5185\u5B58\u3002ps \u547D\u4EE4\u8F93\u51FA\u7B2C\u56DB\u5217\u4EE3\u8868\u8FDB\u7A0B\u4F7F\u7528\u7684\u7269\u7406\u5185\u5B58\u7684\u7528\u91CF\uFF0C\u5355\u4F4D\u4E3A kb\uFF0C\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u6D4B\u8BD5\u8D1F\u8F7D\u4E0B\uFF0C\u8FDB\u7A0B\u7684\u5185\u5B58\u4F7F\u7528\u4E3A 7.7G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 7896792\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 7929692\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         2.0 8101232\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 Doris \u7CFB\u7EDF\u8868\u67E5\u770B\u5F53\u524D Workload Group \u7684\u5185\u5B58\u7528\u91CF\uFF0CWorkload Group \u7684\u5185\u5B58\u7528\u91CF\u4E3A 5.8G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"mysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5797.524360656738 |\n+-------------------+\n1 row in set (0.01 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5840.246627807617 |\n+-------------------+\n1 row in set (0.02 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+-------------------+\n| wg_mem_used_mb    |\n+-------------------+\n| 5878.394917488098 |\n+-------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u8FD9\u91CC\u53EF\u4EE5\u770B\u5230\u8FDB\u7A0B\u7684\u5185\u5B58\u4F7F\u7528\u901A\u5E38\u8981\u8FDC\u5927\u4E8E\u4E00\u4E2A Workload Group \u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5373\u4F7F\u8FDB\u7A0B\u5185\u53EA\u6709\u4E00\u4E2A Workload Group \u5728\u8DD1\uFF0C\u8FD9\u662F\u56E0\u4E3A Workload Group \u53EA\u7EDF\u8BA1\u4E86\u67E5\u8BE2\u548C\u90E8\u5206\u5BFC\u5165\u7684\u5185\u5B58\uFF0C\u8FDB\u7A0B\u5185\u7684\u5176\u4ED6\u7EC4\u4EF6\u6BD4\u5982\u5143\u6570\u636E\uFF0C\u5404\u79CD Cache \u7684\u5185\u5B58\u662F\u4E0D\u8BA1\u7B97 Workload Group \u5185\u7684\uFF0C\u4E5F\u4E0D\u7531 Workload Group \u7BA1\u7406\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u5F00\u542F-workload-group-\u7684\u5185\u5B58\u786C\u9650",children:"\u6D4B\u8BD5\u5F00\u542F Workload Group \u7684\u5185\u5B58\u786C\u9650"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u6267\u884C SQL \u547D\u4EE4\u4FEE\u6539\u5185\u5B58\u914D\u7F6E\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"alter workload group g2 properties('memory_limit'='0.5%');\nalter workload group g2 properties('enable_memory_overcommit'='false');\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u6267\u884C\u540C\u6837\u7684\u6D4B\u8BD5\uFF0C\u67E5\u770B\u7CFB\u7EDF\u8868\u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5185\u5B58\u7528\u91CF\u4E3A 1.5G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"mysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+--------------------+\n| wg_mem_used_mb     |\n+--------------------+\n| 1575.3877239227295 |\n+--------------------+\n1 row in set (0.02 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+------------------+\n| wg_mem_used_mb   |\n+------------------+\n| 1668.77405834198 |\n+------------------+\n1 row in set (0.01 sec)\n\nmysql [information_schema]>select MEMORY_USAGE_BYTES / 1024/ 1024 as wg_mem_used_mb from workload_group_resource_usage where workload_group_id=11201;\n+--------------------+\n| wg_mem_used_mb     |\n+--------------------+\n| 499.96760272979736 |\n+--------------------+\n1 row in set (0.01 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 ps \u547D\u4EE4\u67E5\u770B\u8FDB\u7A0B\u7684\u5185\u5B58\u7528\u91CF\uFF0C\u5185\u5B58\u7528\u91CF\u4E3A 3.8G \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4071364\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4059012\n[ ~]$ ps -eo pid,comm,%mem,rss | grep 1407481\n1407481 doris_be         1.0 4057068\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u540C\u65F6\u5BA2\u6237\u7AEF\u4F1A\u89C2\u5BDF\u5230\u5927\u91CF\u7531\u4E8E\u5185\u5B58\u4E0D\u8DB3\u5BFC\u81F4\u7684\u67E5\u8BE2\u5931\u8D25\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'1724074250162,14126,1c_sql,HY000 1105,"java.sql.SQLException: errCode = 2, detailMessage = (127.0.0.1)[MEM_LIMIT_EXCEEDED]GC wg for hard limit, wg id:11201, name:g2, used:1.71 GB, limit:1.69 GB, backend:10.16.10.8. cancel top memory used tracker <Query#Id=4a0689936c444ac8-a0d01a50b944f6e7> consumption 1.71 GB. details:process memory used 3.01 GB exceed soft limit 304.41 GB or sys available memory 101.16 GB less than warning water mark 12.80 GB., Execute again after enough memory, details see be.INFO.",\u5E76\u53D1 1-3,text,false,,444,0,3,3,null,0,0,0\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u8FD9\u4E2A\u62A5\u9519\u4FE1\u606F\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0CWorkload Group \u4F7F\u7528\u4E86 1.7G \u7684\u5185\u5B58\uFF0C\u4F46\u662F Workload Group \u7684\u9650\u5236\u662F 1.69G\uFF0C\u8FD9\u91CC\u7684\u8BA1\u7B97\u65B9\u5F0F\u662F\u8FD9\u6837\u7684 1.69G = \u7269\u7406\u673A\u5185\u5B58 (375) * mem_limit(be.conf \u4E2D\u7684\u503C\uFF0C\u9ED8\u8BA4\u4E3A 0.9) * 0.5%\uFF08Workload Group \u7684\u914D\u7F6E\uFF09\n\u4E5F\u5C31\u662F\u8BF4\uFF0CWorkload Group \u4E2D\u914D\u7F6E\u7684\u5185\u5B58\u767E\u5206\u6BD4\u662F\u57FA\u4E8E Doris \u8FDB\u7A0B\u53EF\u7528\u5185\u5B58\u518D\u6B21\u8FDB\u884C\u8BA1\u7B97\u7684\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u4F7F\u7528\u5EFA\u8BAE",children:"\u4F7F\u7528\u5EFA\u8BAE"}),"\n",(0,o.jsx)(n.p,{children:"\u5982\u4E0A\u6587\u6D4B\u8BD5\uFF0C\u786C\u9650\u53EF\u4EE5\u63A7\u5236 Workload Group \u7684\u5185\u5B58\u4F7F\u7528\uFF0C\u4F46\u5374\u662F\u901A\u8FC7\u6740\u6B7B\u67E5\u8BE2\u7684\u65B9\u5F0F\u91CA\u653E\u5185\u5B58\uFF0C\u8FD9\u5BF9\u7528\u6237\u6765\u8BF4\u4F53\u9A8C\u4F1A\u975E\u5E38\u4E0D\u53CB\u597D\uFF0C\u6781\u7AEF\u60C5\u51B5\u4E0B\u53EF\u80FD\u4F1A\u5BFC\u81F4\u6240\u6709\u67E5\u8BE2\u90FD\u5931\u8D25\u3002\n\u56E0\u6B64\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u63A8\u8350\u5185\u5B58\u786C\u9650\u914D\u5408\u67E5\u8BE2\u6392\u961F\u7684\u529F\u80FD\u4E00\u8D77\u4F7F\u7528\uFF0C\u53EF\u4EE5\u5728\u9650\u5236\u5185\u5B58\u4F7F\u7528\u7684\u540C\u65F6\u4FDD\u8BC1\u67E5\u8BE2\u7684\u6210\u529F\u7387\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"cpu-\u786C\u9650\u6D4B\u8BD5",children:"CPU \u786C\u9650\u6D4B\u8BD5"}),"\n",(0,o.jsx)(n.p,{children:"Doris \u7684\u8D1F\u8F7D\u5927\u4F53\u53EF\u4EE5\u5206\u4E3A\u4E09\u7C7B\uFF1A"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u6838\u5FC3\u62A5\u8868\u67E5\u8BE2\uFF0C\u901A\u5E38\u7ED9\u516C\u53F8\u9AD8\u5C42\u67E5\u770B\u62A5\u8868\u4F7F\u7528\uFF0C\u8D1F\u8F7D\u4E0D\u4E00\u5B9A\u5F88\u9AD8\uFF0C\u4F46\u662F\u5BF9\u53EF\u7528\u6027\u8981\u6C42\u8F83\u9AD8\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u53EF\u4EE5\u5212\u5206\u5230\u4E00\u4E2A\u5206\u7EC4\uFF0C\u914D\u7F6E\u8F83\u9AD8\u4F18\u5148\u7EA7\u7684\u8F6F\u9650\uFF0C\u4FDD\u8BC1 CPU \u8D44\u6E90\u4E0D\u591F\u65F6\u53EF\u4EE5\u83B7\u5F97\u66F4\u591A\u7684 CPU \u8D44\u6E90\u3002"}),"\n",(0,o.jsx)(n.li,{children:"Adhoc \u7C7B\u67E5\u8BE2\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u901A\u5E38\u504F\u63A2\u7D22\u5206\u6790\uFF0CSQL \u6BD4\u8F83\u968F\u673A\uFF0C\u5177\u4F53\u7684\u8D44\u6E90\u7528\u91CF\u4E5F\u6BD4\u8F83\u672A\u77E5\uFF0C\u4F18\u5148\u7EA7\u901A\u5E38\u4E0D\u9AD8\u3002\u56E0\u6B64\u53EF\u4EE5\u4F7F\u7528 CPU \u786C\u9650\u8FDB\u884C\u7BA1\u7406\uFF0C\u5E76\u914D\u7F6E\u8F83\u4F4E\u7684\u503C\uFF0C\u907F\u514D\u5360\u7528\u8FC7\u591A CPU \u8D44\u6E90\u964D\u4F4E\u96C6\u7FA4\u53EF\u7528\u6027\u3002"}),"\n",(0,o.jsx)(n.li,{children:"ETL \u7C7B\u67E5\u8BE2\uFF0C\u8FD9\u7C7B\u67E5\u8BE2\u7684 SQL \u6BD4\u8F83\u56FA\u5B9A\uFF0C\u8D44\u6E90\u7528\u91CF\u901A\u5E38\u4E5F\u6BD4\u8F83\u7A33\u5B9A\uFF0C\u5076\u5C14\u4F1A\u51FA\u73B0\u4E0A\u6E38\u6570\u636E\u91CF\u589E\u957F\u5BFC\u81F4\u8D44\u6E90\u7528\u91CF\u66B4\u6DA8\u7684\u60C5\u51B5\uFF0C\u56E0\u6B64\u53EF\u4EE5\u4F7F\u7528 CPU \u786C\u9650\u8FDB\u884C\u914D\u7F6E\u3002"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u4E0D\u540C\u7684\u8D1F\u8F7D\u5BF9 CPU \u7684\u6D88\u8017\u4E0D\u4E00\u6837\uFF0C\u7528\u6237\u5BF9\u54CD\u5E94\u5EF6\u65F6\u7684\u9700\u6C42\u4E5F\u4E0D\u4E00\u6837\u3002\u5F53 BE \u7684 CPU \u88AB\u7528\u7684\u5F88\u6EE1\u65F6\uFF0C\u53EF\u7528\u6027\u4F1A\u53D8\u5DEE\uFF0C\u54CD\u5E94\u5EF6\u65F6\u4F1A\u53D8\u9AD8\u3002\u6BD4\u5982\u53EF\u80FD\u4E00\u4E2A Adhoc \u7684\u5206\u6790\u7C7B\u67E5\u8BE2\u628A\u6574\u4E2A\u96C6\u7FA4\u7684 CPU \u6253\u6EE1\uFF0C\u5BFC\u81F4\u6838\u5FC3\u62A5\u8868\u7684\u5EF6\u65F6\u53D8\u5927\uFF0C\u5F71\u54CD\u5230\u4E86 SLA\u3002\u6240\u4EE5\u9700\u8981 CPU \u9694\u79BB\u673A\u5236\u6765\u5BF9\u4E0D\u540C\u7684\u4E1A\u52A1\u8FDB\u884C\u9694\u79BB\uFF0C\u4FDD\u969C\u96C6\u7FA4\u7684\u53EF\u7528\u6027\u548C SLA\u3002\nWorkload Group \u652F\u6301 CPU \u7684\u8F6F\u9650\u548C\u786C\u9650\uFF0C\u76EE\u524D\u6BD4\u8F83\u63A8\u8350\u5728\u7EBF\u4E0A\u73AF\u5883\u628A Workload Group \u914D\u7F6E\u6210\u786C\u9650\u3002\u539F\u56E0\u662F CPU \u7684\u8F6F\u9650\u901A\u5E38\u5728 CPU \u88AB\u6253\u6EE1\u65F6\u624D\u80FD\u4F53\u73B0\u51FA\u4F18\u5148\u7EA7\u7684\u4F5C\u7528\uFF0C\u4F46\u662F\u5728 CPU \u88AB\u7528\u6EE1\u65F6\uFF0CDoris \u7684\u5185\u90E8\u7EC4\u4EF6\uFF08\u4F8B\u5982 rpc \u7EC4\u4EF6\uFF09\u4EE5\u53CA\u64CD\u4F5C\u7CFB\u7EDF\u53EF\u7528\u7684 CPU \u4F1A\u51CF\u5C11\uFF0C\u6B64\u65F6\u96C6\u7FA4\u6574\u4F53\u7684\u53EF\u7528\u6027\u662F\u4E0B\u964D\u6BD4\u8F83\u4E25\u91CD\u7684\uFF0C\u56E0\u6B64\u751F\u4EA7\u73AF\u5883\u901A\u5E38\u9700\u8981\u907F\u514D CPU \u8D44\u6E90\u88AB\u6253\u6EE1\u7684\u60C5\u51B5\uFF0C\u5F53\u7136\u5176\u4ED6\u8D44\u6E90\u4E5F\u4E00\u6837\uFF0C\u5185\u5B58\u8D44\u6E90\u540C\u7406\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u73AF\u5883-1",children:"\u6D4B\u8BD5\u73AF\u5883"}),"\n",(0,o.jsx)(n.p,{children:"1FE\uFF0C1BE\uFF0C96 \u6838\u673A\u5668\u3002\n\u6570\u636E\u96C6\u4E3A clickbench\uFF0C\u6D4B\u8BD5 sql \u4E3A q29\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5",children:"\u6D4B\u8BD5"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 jmeter \u53D1\u8D77 3 \u5E76\u53D1\u67E5\u8BE2\uFF0C\u628A BE \u8FDB\u7A0B\u7684 CPU \u4F7F\u7528\u538B\u5230\u6BD4\u8F83\u9AD8\u7684\u4F7F\u7528\u7387\uFF0C\u8FD9\u91CC\u6D4B\u8BD5\u7684\u673A\u5668\u662F 96 \u6838\uFF0C\u4F7F\u7528 top \u547D\u4EE4\u770B\u5230 BE \u8FDB\u7A0B CPU \u4F7F\u7528\u7387\u4E3A 7600% \u7684\u542B\u4E49\u662F\u8BE5\u8FDB\u7A0B\u76EE\u524D\u4F7F\u7528\u4E2D\u7684\u6838\u6570\u662F 76 \u4E2A\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group cpu",src:r(53982).Z+"",width:"962",height:"146"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4FEE\u6539\u4F7F\u7528\u4E2D\u7684 Workload Group \u7684 CPU \u786C\u9650\u4E3A 10%\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"alter workload group g2 properties('cpu_hard_limit'='10%');\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u96C6\u7FA4\u5F00\u542F\u786C\u9650\u6A21\u5F0F\uFF0C\u6B64\u65F6\u96C6\u7FA4\u4E2D\u6240\u6709 Group \u90FD\u4F1A\u5207\u6362\u4E3A\u786C\u9650\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'ADMIN SET FRONTEND CONFIG ("enable_cpu_hard_limit" = "true");\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u91CD\u65B0\u538B\u6D4B\u67E5\u8BE2\u8D1F\u8F7D\uFF0C\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u8FDB\u7A0B\u53EA\u80FD\u4F7F\u7528 9 \u5230 10 \u4E2A\u6838\uFF0C\u5360\u603B\u6838\u6570\u7684 10% \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group cpu",src:r(665930).Z+"",width:"1138",height:"180"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u91CC\u7684\u6D4B\u8BD5\u6700\u597D\u4F7F\u7528\u67E5\u8BE2\u8D1F\u8F7D\u4F1A\u6BD4\u8F83\u80FD\u4F53\u73B0\u51FA\u6548\u679C\uFF0C\u56E0\u4E3A\u5982\u679C\u662F\u9AD8\u541E\u5410\u5BFC\u5165\u7684\u8BDD\uFF0C\u53EF\u80FD\u4F1A\u89E6\u53D1 Compaction\uFF0C\u4F7F\u5F97\u5B9E\u9645\u89C2\u6D4B\u7684\u503C\u8981\u6BD4 Workload Group \u914D\u7F6E\u7684\u503C\u5927\u3002\u800C Compaction \u7684\u8D1F\u8F7D\u76EE\u524D\u662F\u6CA1\u6709\u5F52\u5165 Workload Group \u7684\u7BA1\u7406\u7684\u3002"}),"\n",(0,o.jsxs)(n.ol,{start:"5",children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u9664\u4E86\u4F7F\u7528 Linux \u7684\u7CFB\u7EDF\u547D\u4EE4\u5916\uFF0C\u8FD8\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528 Doris \u7684\u7CFB\u7EDF\u8868\u89C2\u5BDF Group \u76EE\u524D\u7684 CPU \u4F7F\u7528\u4E3A 10% \u5DE6\u53F3\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"mysql [information_schema]>select CPU_USAGE_PERCENT from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+-------------------+\n| CPU_USAGE_PERCENT |\n+-------------------+\n|              9.57 |\n+-------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u5728\u5B9E\u9645\u914D\u7F6E\u7684\u65F6\u5019\uFF0C\u6240\u6709 Group \u7684 CPU \u7D2F\u52A0\u503C\u6700\u597D\u4E0D\u8981\u6B63\u597D\u7B49\u4E8E 100%\uFF0C\u8FD9\u4E3B\u8981\u662F\u4E3A\u4E86\u4FDD\u8BC1\u4F4E\u5EF6\u8FDF\u573A\u666F\u7684\u53EF\u7528\u6027\u3002\u56E0\u4E3A\u9700\u8981\u8BA9\u51FA\u4E00\u90E8\u5206\u8D44\u6E90\u7ED9\u5176\u4ED6\u7EC4\u4EF6\u4F7F\u7528\u3002\u5F53\u7136\u5982\u679C\u5BF9\u5EF6\u8FDF\u4E0D\u662F\u5F88\u654F\u611F\u7684\u573A\u666F\uFF0C\u671F\u671B\u6700\u9AD8\u7684\u8D44\u6E90\u5229\u7528\u7387\uFF0C\u90A3\u4E48\u53EF\u4EE5\u8003\u8651\u6240\u6709 Group \u7684 CPU \u7D2F\u52A0\u503C\u914D\u7F6E\u7B49\u4E8E 100%\u3002"}),"\n",(0,o.jsx)(n.li,{children:"\u76EE\u524D FE \u5411 BE \u540C\u6B65 Workload Group \u5143\u6570\u636E\u7684\u65F6\u95F4\u95F4\u9694\u4E3A 30 \u79D2\uFF0C\u56E0\u6B64\u5BF9\u4E8E Workload Group \u7684\u53D8\u66F4\u6700\u5927\u9700\u8981\u7B49\u5F85 30 \u79D2\u624D\u80FD\u751F\u6548\u3002"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6D4B\u8BD5\u672C\u5730-io-\u786C\u9650",children:"\u6D4B\u8BD5\u672C\u5730 IO \u786C\u9650"}),"\n",(0,o.jsx)(n.p,{children:"OLAP \u7CFB\u7EDF\u5728\u505A ETL \u6216\u8005\u5927\u7684 Adhoc \u67E5\u8BE2\u65F6\uFF0C\u9700\u8981\u8BFB\u53D6\u5927\u91CF\u7684\u6570\u636E\uFF0CDoris \u4E3A\u4E86\u52A0\u901F\u6570\u636E\u5206\u6790\u8FC7\u7A0B\uFF0C\u5185\u90E8\u4F1A\u4F7F\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u7684\u65B9\u5F0F\u5BF9\u591A\u4E2A\u78C1\u76D8\u6587\u4EF6\u626B\u63CF\uFF0C\u4F1A\u4EA7\u751F\u5DE8\u5927\u7684\u78C1\u76D8 IO\uFF0C\u5C31\u4F1A\u5BF9\u5176\u4ED6\u7684\u67E5\u8BE2\uFF08\u6BD4\u5982\u62A5\u8868\u5206\u6790\uFF09\u4EA7\u751F\u5F71\u54CD\u3002\n\u53EF\u4EE5\u901A\u8FC7 Workload Group \u5BF9\u79BB\u7EBF\u7684 ETL \u6570\u636E\u5904\u7406\u548C\u5728\u7EBF\u7684\u62A5\u8868\u67E5\u8BE2\u505A\u5206\u7EC4\uFF0C\u9650\u5236\u79BB\u7EBF\u6570\u636E\u5904\u7406 IO \u5E26\u5BBD\u7684\u65B9\u5F0F\uFF0C\u964D\u4F4E\u5B83\u5BF9\u5728\u7EBF\u62A5\u8868\u5206\u6790\u7684\u5F71\u54CD\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u73AF\u5883-2",children:"\u6D4B\u8BD5\u73AF\u5883"}),"\n",(0,o.jsx)(n.p,{children:"1FE,1BE, \u914D\u7F6E\u4E3A 96 \u6838\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u6D4B\u8BD5\u6570\u636E\u96C6\u4E3A clickbench\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u4E0D\u5F00\u542F-io-\u786C\u9650\u6D4B\u8BD5",children:"\u4E0D\u5F00\u542F IO \u786C\u9650\u6D4B\u8BD5"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5173\u95ED\u7F13\u5B58\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"// \u6E05\u7A7A\u64CD\u4F5C\u7CFB\u7EDF\u7F13\u5B58\nsync; echo 3 > /proc/sys/vm/drop_caches\n\n// \u7981\u7528 BE \u7684 page cache\ndisable_storage_page_cache = true\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5BF9 clickbench \u7684\u8868\u6267\u884C\u5168\u8868\u626B\u63CF\uFF0C\u6267\u884C\u5355\u5E76\u53D1\u67E5\u8BE2\u5373\u53EF\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"set dry_run_query = true;\nselect * from hits.hits;\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u901A\u8FC7 Doris \u7684\u5185\u8868\u67E5\u770B\u5F53\u524D Group \u7684\u6700\u5927\u541E\u5410\u4E3A 3GB \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"mysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 1146.6208400726318 |\n+--------------------+\n1 row in set (0.03 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 3496.2762966156006 |\n+--------------------+\n1 row in set (0.04 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 2192.7690029144287 |\n+--------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 pidstat \u547D\u4EE4\u67E5\u770B\u8FDB\u7A0B IO\uFF0C\u56FE\u4E2D\u7B2C\u4E00\u5217\u662F\u8FDB\u7A0B id\uFF0C\u7B2C\u4E8C\u5217\u662F\u8BFB IO \u7684\u541E\u5410\uFF08\u5355\u4F4D\u662F kb/s\uFF09\u3002\u53EF\u4EE5\u770B\u5230\u4E0D\u9650\u5236 IO \u65F6\uFF0C\u6700\u5927\u541E\u5410\u4E3A 2G \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group io",src:r(715719).Z+"",width:"814",height:"1080"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u5F00\u542F-io-\u786C\u9650\u540E\u6D4B\u8BD5",children:"\u5F00\u542F IO \u786C\u9650\u540E\u6D4B\u8BD5"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5173\u95ED\u7F13\u5B58\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"// \u6E05\u7A7A\u64CD\u4F5C\u7CFB\u7EDF\u7F13\u5B58\nsync; echo 3 > /proc/sys/vm/drop_caches\n\n// \u7981\u7528 BE \u7684 page cache\ndisable_storage_page_cache = true\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4FEE\u6539 Workload Group \u7684\u914D\u7F6E\uFF0C\u9650\u5236\u6BCF\u79D2\u6700\u5927\u541E\u5410\u4E3A 100M\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"// \u9650\u5236\u5F53\u524D Group \u7684\u8BFB\u541E\u5410\u4E3A\u6BCF\u79D2 100M\nalter workload group g2 properties('read_bytes_per_second'='104857600');\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 Doris \u7CFB\u7EDF\u8868\u67E5\u770B Workload Group \u7684\u6700\u5927 IO \u541E\u5410\u4E3A\u6BCF\u79D2 98M\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"mysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 97.94296646118164  |\n+--------------------+\n1 row in set (0.03 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 98.37584781646729  |\n+--------------------+\n1 row in set (0.04 sec)\n\nmysql [information_schema]>select LOCAL_SCAN_BYTES_PER_SECOND / 1024 / 1024 as mb_per_sec from workload_group_resource_usage where WORKLOAD_GROUP_ID=11201;\n+--------------------+\n| mb_per_sec         |\n+--------------------+\n| 98.06641292572021  |\n+--------------------+\n1 row in set (0.02 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 pid \u5DE5\u5177\u67E5\u770B\u8FDB\u7A0B\u6700\u5927 IO \u541E\u5410\u4E3A\u6BCF\u79D2 131M\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group io",src:r(10987).Z+"",width:"808",height:"676"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u6CE8\u610F\u4E8B\u9879-1",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u7CFB\u7EDF\u8868\u4E2D\u7684 LOCAL_SCAN_BYTES_PER_SECOND \u5B57\u6BB5\u4EE3\u8868\u7684\u662F\u5F53\u524D Workload Group \u5728\u8FDB\u7A0B\u7C92\u5EA6\u7684\u7EDF\u8BA1\u6C47\u603B\u503C\uFF0C\u6BD4\u5982\u914D\u7F6E\u4E86 12 \u4E2A\u6587\u4EF6\u8DEF\u5F84\uFF0C\u90A3\u4E48 LOCAL_SCAN_BYTES_PER_SECOND \u5C31\u662F\u8FD9 12 \u4E2A\u6587\u4EF6\u8DEF\u5F84 IO \u7684\u6700\u5927\u503C\uFF0C\u5982\u679C\u671F\u671B\u67E5\u770B\u6BCF\u4E2A\u6587\u4EF6\u8DEF\u5F84\u5206\u522B\u7684 IO \u541E\u5410\uFF0C\u53EF\u4EE5\u5728 grafana \u4E0A\u6216\u8005 BE \u7684 bvar \u76D1\u63A7\u67E5\u770B\u660E\u7EC6\u7684\u503C\u3002"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u7531\u4E8E\u64CD\u4F5C\u7CFB\u7EDF\u548C Doris \u7684 Page Cache \u7684\u5B58\u5728\uFF0C\u901A\u8FC7 linux \u7684 IO \u76D1\u63A7\u811A\u672C\u770B\u5230\u7684 IO \u901A\u5E38\u8981\u6BD4\u7CFB\u7EDF\u8868\u770B\u5230\u7684\u8981\u5C0F\u3002"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6D4B\u8BD5\u8FDC\u7A0B-io-\u9650\u5236",children:"\u6D4B\u8BD5\u8FDC\u7A0B IO \u9650\u5236"}),"\n",(0,o.jsx)(n.p,{children:"BrokerLoad \u548C S3Load \u662F\u5E38\u7528\u7684\u5927\u6279\u91CF\u6570\u636E\u5BFC\u5165\u65B9\u5F0F\uFF0C\u7528\u6237\u53EF\u4EE5\u628A\u6570\u636E\u5148\u4E0A\u4F20\u5230 HDFS \u6216\u8005 S3\uFF0C\u7136\u540E\u901A\u8FC7 Brokerload \u548C S3Load \u5BF9\u6570\u636E\u8FDB\u884C\u5E76\u884C\u5BFC\u5165\u3002Doris \u4E3A\u4E86\u52A0\u5FEB\u5BFC\u5165\u901F\u5EA6\uFF0C\u4F1A\u4F7F\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u7684\u65B9\u5F0F\u4ECE HDFS/S3 \u62C9\u53D6\u6570\u636E\uFF0C\u6B64\u65F6\u4F1A\u5BF9 HDFS/S3 \u4EA7\u751F\u5DE8\u5927\u7684\u538B\u529B\uFF0C\u4F1A\u5BFC\u81F4 HDFS/S3 \u4E0A\u8FD0\u884C\u7684\u522B\u7684\u4F5C\u4E1A\u4E0D\u7A33\u5B9A\u3002\n\u53EF\u4EE5\u901A\u8FC7 Workload Group \u8FDC\u7A0B IO \u7684\u9650\u5236\u529F\u80FD\u6765\u9650\u5236\u5BFC\u5165\u8FC7\u7A0B\u4E2D\u5BF9 HDFS/S3 \u7684\u5E26\u5BBD\uFF0C\u964D\u4F4E\u5BF9\u5176\u4ED6\u4E1A\u52A1\u7684\u5F71\u54CD\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u73AF\u5883-3",children:"\u6D4B\u8BD5\u73AF\u5883"}),"\n",(0,o.jsx)(n.p,{children:"1FE\uFF0C1BE \u90E8\u7F72\u5728\u540C\u4E00\u53F0\u673A\u5668\uFF0C\u914D\u7F6E\u4E3A 16 \u6838 64G \u5185\u5B58\u3002\u6D4B\u8BD5\u6570\u636E\u4E3A clickbench \u6570\u636E\u96C6\uFF0C\u6D4B\u8BD5\u524D\u9700\u8981\u628A\u6570\u636E\u96C6\u4E0A\u4F20\u5230 S3 \u4E0A\u3002\u8003\u8651\u5230\u4E0A\u4F20\u65F6\u95F4\u7684\u95EE\u9898\uFF0C\u6211\u4EEC\u53EA\u53D6\u5176\u4E2D\u7684 1 \u5343\u4E07\u884C\u6570\u636E\u4E0A\u4F20\uFF0C\u7136\u540E\u4F7F\u7528 tvf \u7684\u529F\u80FD\u67E5\u8BE2 s3 \u7684\u6570\u636E\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u4E0A\u4F20\u6210\u529F\u540E\u53EF\u4EE5\u4F7F\u7528\u547D\u4EE4\u67E5\u770B Schema \u4FE1\u606F\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'```sql\n// \u67E5\u770Bschema\nDESC FUNCTION s3 (\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n```\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u4E0D\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684-io",children:"\u6D4B\u8BD5\u4E0D\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u53D1\u8D77\u5355\u5E76\u53D1\u6D4B\u8BD5\uFF0C\u5168\u8868\u626B\u63CF clickbench \u8868\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'// \u8BBE\u7F6E\u53EA scan \u6570\u636E\uFF0C\u4E0D\u8FD4\u56DE\u7ED3\u679C\nset dry_run_query = true;\n\n// \u4F7F\u7528 tvf \u67E5\u8BE2 s3 \u7684\u6570\u636E\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528\u7CFB\u7EDF\u8868\u67E5\u770B\u6B64\u65F6\u7684\u8FDC\u7A0B IO \u541E\u5410\u3002\u53EF\u4EE5\u770B\u5230\u8FD9\u4E2A\u67E5\u8BE2\u7684\u8FDC\u7A0B IO \u541E\u5410\u4E3A 837M \u6BCF\u79D2\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u91CC\u7684\u5B9E\u9645 IO \u541E\u5410\u53D7\u73AF\u5883\u5F71\u54CD\u8F83\u5927\uFF0C\u5982\u679C BE \u6240\u5728\u7684\u673A\u5668\u8FDE\u63A5\u5916\u90E8\u5B58\u50A8\u7684\u5E26\u5BBD\u6BD4\u8F83\u4F4E\uFF0C\u90A3\u4E48\u53EF\u80FD\u5B9E\u9645\u7684\u541E\u5410\u4F1A\u5C0F\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     837 |\n+---------+\n1 row in set (0.104 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.070 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.186 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 sar(sar -n DEV 1 3600) \u547D\u4EE4\u67E5\u770B\u673A\u5668\u7684\u7F51\u7EDC\u5E26\u5BBD\uFF0C\u53EF\u4EE5\u770B\u5230\u673A\u5668\u7EA7\u522B\u6700\u5927\u7F51\u7EDC\u5E26\u5BBD\u4E3A 1033M \u6BCF\u79D2\u3002\n\u8F93\u51FA\u7684\u7B2C\u4E00\u5217\u4E3A\u5F53\u524D\u673A\u5668\u67D0\u4E2A\u7F51\u5361\u6BCF\u79D2\u63A5\u6536\u7684\u5B57\u8282\u6570\uFF0C\u5355\u4F4D\u4E3A KB \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group rio",src:r(716653).Z+"",width:"960",height:"436"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u6D4B\u8BD5\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684-io",children:"\u6D4B\u8BD5\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4FEE\u6539 Workload Group \u7684\u914D\u7F6E\uFF0C\u9650\u5236\u8FDC\u7A0B\u8BFB\u7684 IO \u541E\u5410\u4E3A 100M \u6BCF\u79D2\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"alter workload group normal properties('remote_read_bytes_per_second'='104857600');\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u53D1\u8D77\u5355\u5E76\u53D1\u626B\u5168\u8868\u7684\u67E5\u8BE2\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'// \u8BBE\u7F6E\u53EA scan \u6570\u636E\uFF0C\u4E0D\u8FD4\u56DE\u7ED3\u679C\nset dry_run_query = true;\n\n// \u4F7F\u7528 tvf \u67E5\u8BE2 s3 \u7684\u6570\u636E\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528\u7CFB\u7EDF\u8868\u67E5\u770B\u6B64\u65F6\u7684\u8FDC\u7A0B\u8BFB IO \u541E\u5410\uFF0C\u6B64\u65F6\u7684 IO \u541E\u5410\u5728 100M \u5DE6\u53F3\uFF0C\u4F1A\u6709\u4E00\u5B9A\u7684\u6CE2\u52A8\uFF0C\u8FD9\u4E2A\u6CE2\u52A8\u662F\u53D7\u76EE\u524D\u7B97\u6CD5\u8BBE\u8BA1\u7684\u5F71\u54CD\uFF0C\u901A\u5E38\u4F1A\u6709\u4E00\u4E2A\u9AD8\u5CF0\uFF0C\u4F46\u4E0D\u4F1A\u6301\u7EED\u5F88\u957F\u65F6\u95F4\uFF0C\u5C5E\u4E8E\u6B63\u5E38\u60C5\u51B5\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|      56 |\n+---------+\n1 row in set (0.010 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     131 |\n+---------+\n1 row in set (0.009 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     111 |\n+---------+\n1 row in set (0.009 sec)\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 sar \u547D\u4EE4\uFF08sar -n DEV 1 3600\uFF09\u67E5\u770B\u76EE\u524D\u7684\u7F51\u5361\u63A5\u6536\u6D41\u91CF\uFF0C\u7B2C\u4E00\u5217\u4E3A\u6BCF\u79D2\u63A5\u6536\u7684\u6570\u636E\u91CF\uFF0C\u53EF\u4EE5\u770B\u5230\u6700\u5927\u503C\u53D8\u6210\u4E86 207M \u6BCF\u79D2\uFF0C\u8BF4\u660E\u8BFB IO \u7684\u9650\u5236\u662F\u751F\u6548\u7684\uFF0C\u4F46\u662F\u7531\u4E8E sar \u547D\u4EE4\u770B\u5230\u7684\u662F\u673A\u5668\u7EA7\u522B\u7684\u6D41\u91CF\uFF0C\u56E0\u6B64\u8981\u6BD4 Doris \u7EDF\u8BA1\u5230\u7684\u4F1A\u5927\u4E00\u4E9B\u3002"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group rio",src:r(674967).Z+"",width:"864",height:"472"})}),"\n"]}),"\n"]})]})}function t(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(_,{...e})}):_(e)}},53982:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_cpu_1-6211d7170720ad508590d94cf72724e3.png"},665930:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_cpu_2-03419ba3e02b1980179a1af557d41d1c.png"},715719:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_io_1-15b5d3e97f7ccf7f914eef0e6bf55cd4.png"},10987:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_io_2-2202fea206c596a3879c6660ada71037.png"},716653:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_rio_1-e3ae321d5e709bb0ba21b9572d2bce1f.png"},674967:function(e,n,r){r.d(n,{Z:function(){return s}});let s=r.p+"assets/images/use_wg_rio_2-7511c9afedf43b931909b18e529f00ea.png"},250065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return a}});var s=r(667294);let o={},l=s.createContext(o);function a(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);